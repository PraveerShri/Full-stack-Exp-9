###############################################
# Stage 1 — Build Stage
###############################################
# Use an official lightweight Node.js image for building the React app
FROM node:18-alpine AS build

# Set a working directory inside the container
# All subsequent commands will be executed from this directory
WORKDIR /app

# Copy only package.json and package-lock.json (or yarn.lock)
# Doing this first allows Docker to cache the npm install layer
# so dependencies are not reinstalled unnecessarily if source code changes later.
COPY package*.json ./

# Install all dependencies required for building the app
# We use npm ci instead of npm install for reproducible builds
RUN npm ci

# Copy the rest of the application source code into the working directory
# This includes public/, src/, and other project files
COPY . .

# Build the React app for production
# This will create an optimized build inside the "build" folder
RUN npm run build


###############################################
# Stage 2 — Production Stage
###############################################
# Use a lightweight Nginx image to serve the static files
FROM nginx:alpine

# Copy the build folder from the previous stage into Nginx’s default HTML directory
# /usr/share/nginx/html is where Nginx serves static content by default
COPY --from=build /app/build /usr/share/nginx/html

# (Optional) Remove default Nginx config and replace it with a custom one if needed
# COPY nginx.conf /etc/nginx/conf.d/default.conf

# Expose port 80 so Docker can map it to your local machine
EXPOSE 80

# Start the Nginx server
CMD ["nginx", "-g", "daemon off;"]
